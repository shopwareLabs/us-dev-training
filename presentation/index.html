<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Shopware US-Dev workshop</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="dist/theme/black.css">

    <!-- Shopware theme -->
    <style>
        :root {
            --r-heading-color: #0870ff;
            --r-link-color: #0870ff;
            --r-background-color: rgb(23, 29, 34);
            --r-main-font: Inter, -apple-system, Arial, sans-serif;
            --r-heading-font-weight: bold;
            --r-heading-font: Poppins, -apple-system, Arial, sans-serif;
            --r-heading-text-transform: none;
            --r-highlight-color: #adbac7;
        }

        .reveal .slide-number {
            font-size: 0.5em;
            bottom: unset;
            top: 8px;
            background-color: unset;
        }

        .reveal pre {
            font-size: 0.5em;
        }

        .no-line-numbers {
            .hljs-ln-numbers {
                display: none;
            }
        }

        .reveal .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
        }

        .reveal .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .reveal .panel {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.4rem;
            margin: 0.2rem;
            border-radius: 0.5rem;

            /* Nested sub-panel */
            .panel {
                background: rgba(0, 0, 0, 0.1);
            }
        }

        .reveal .headline-sm {
            font-size: 0.7em;
        }

        .reveal .profile-img {
            border-radius: 50%;
            max-width: 70%;
            max-height: 70%;
        }

        .reveal .small {
            font-size: 0.6em;
        }

        code.inline {
            background-color: #22272e;
            color: #adbac7;
            padding: 4px 8px;
            border: 2px solid black;
            /* todo: add some margin / prevent overlap of adjacent code blocks */
        }
    </style>

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/themes/github-dark-dimmed.min.css">
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h1>Shopware development</h1>
        </section>

        <section>
            <h3>Introduction</h3>
            <div class="grid-3">
                <div>
                    <img src="img/malte.jpeg" class="profile-img">
                    <h6 class="headline-sm">Malte Janz</h6>
                    <small>Engineering Lead<br>(CRM & After Sales)</small>
                </div>

                <div>
                    <img src="img/jozsef.jpeg" class="profile-img">
                    <h6 class="headline-sm">Jozsef Damokos</h6>
                    <small>Software Developer<br>(CRM & After Sales)</small>
                </div>

                <div>
                    <img src="img/tobi.jpeg" class="profile-img">
                    <h6 class="headline-sm">Tobias Berge</h6>
                    <small>Software Developer<br>(Framework - Storefront)</small>
                </div>
            </div>
        </section>

        <section>
            <h2>Agenda</h2>
            <p>What we'll do</p>
            <ul>
                <li>Architecture overview & design principles</li>
                <li>Building a new plugin: FAQ</li>
                <li>How to extend shopware in different /areas</li>
                <li>Best practice database structure</li>
                <li>How to extend the admin</li>
                <li>How to extend the Storefront</li>
            </ul>
        </section>

        <section>
            <h2>Timeline</h2>
            <div>
                <ul>
                    <li>
                        <strong>09 AM - Introduction & Setup</strong>
                    </li>
                    <li>
                        Core (Backend) Development
                    </li>
                    <li>
                        Administration Development
                    </li>
                    <li>
                        <strong>1:00 PM - 2:00 PM - Lunch Break</strong>
                    </li>
                    <li>
                        Administration Development (continued)
                    </li>
                    <li>
                        Storefront Development
                    </li>
                    <li>
                        Best practices, tips, Q&A
                    </li>
                    <li>
                        <strong>5:00 PM - Finish</strong>
                    </li>
                </ul>
            </div>
        </section>

        <section>
            <h2>Shopware overview</h2>
            <ul>
                <li>E-Commerce platform</li>
                <li>Open source</li>
                <li>Based on PHP Symfony 7</li>
                <li>Vue 3 (Administration)</li>
                <li>Twig, Bootstrap (Storefront)</li>
            </ul>
        </section>

        <section>
            <h2>Concepts</h2>

            <div class="grid-2">
                <div class="panel" style="background: #285d7e;">
                    Commerce
                    <div class="grid-2">
                        <div class="panel small">
                            <strong style="display: block;">Catalog</strong>
                            <ul>
                                <li>Products</li>
                                <li>Categories</li>
                                <li>Sales Channels</li>
                            </ul>
                        </div>
                        <div class="panel small">
                            <strong style="display: block;">Cart</strong>
                            <ul>
                                <li>Cart</li>
                                <li>Orders</li>
                                <li>Payments</li>
                            </ul>
                        </div>
                        <div class="panel small">
                            <strong style="display: block;">Content</strong>
                            <ul>
                                <li>Shopping Experiences (CMS)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="panel" style="background: #936319;">
                    Framework
                    <div class="grid-2">
                        <small class="panel">
                            Data Abstraction Layer
                        </small>
                        <small class="panel">
                            Messaging
                        </small>
                        <small class="panel">
                            Migrations
                        </small>
                        <small class="panel">
                            Rules
                        </small>
                        <small class="panel">
                            HTTP Cache
                        </small>
                        <small class="panel">
                            Elasticsearch
                        </small>
                        <small class="panel">
                            Flow
                        </small>
                        <small class="panel">
                            System Check
                        </small>
                    </div>
                </div>
                <div class="panel" style="background: #6517a6;">
                    Extensions
                    <div class="grid-2">
                        <small class="panel">
                            Apps
                        </small>
                        <small class="panel">
                            Plugins
                        </small>
                    </div>
                </div>
                <div class="panel" style="background: #335933;">
                    API
                    <div class="grid-2">
                        <small class="panel">
                            Admin API
                        </small>
                        <small class="panel">
                            Store API
                        </small>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>Repositories</h2>
            <div class="grid-2">
                <div class="panel" style="background: #285d7e;">
                    shopware<br>
                    <small>Commerce core - open source (MIT)</small>
                </div>

                <div class="panel" style="background: #22272e;">
                    SwagCommercial<br>
                    <small>Commercial features &dash; AI copilot, B2B components, spacial commerce etc.</small>
                </div>

                <div class="panel" style="background: #22272e;">
                    meteor<br>
                    <small>admin-sdk, component-library, icon-kit</small>
                </div>

                <div class="panel" style="background: #22272e;">
                    shopware-cli<br>
                    <small>Manage, build, validate extensions</small>
                </div>

                <div class="panel" style="background: #22272e;">
                    frontends<br>
                    <small>Vue.js framework for building custom storefronts</small>
                </div>
            </div>
        </section>

        <section>
            <h2>Hosting</h2>
            <div class="grid-3">
                <div class="panel" style="background: #22272e;">
                    Self hosted
                    <ul class="small">
                        <li>Hosted on your own server</li>
                        <li>Updates are done by you</li>
                        <li>Extensions via plugins and apps</li>
                        <li>Full code ownership</li>
                    </ul>
                </div>

                <div class="panel" style="background: #22272e;">
                    SaaS<br>
                    <ul class="small">
                        <li>Hosted by shopware</li>
                        <li>Updates are done by shopware</li>
                        <li>Deployments are done by shopware</li>
                        <li>Installation done by shopware</li>
                        <li>Extensions via apps</li>
                    </ul>
                </div>

                <div class="panel" style="background: #22272e;">
                    PaaS<br>
                    <ul class="small">
                        <li>Full code ownership like with self-hosted</li>
                        <li>Full extensions capabilities</li>
                        <li>Infrastructure done by shopware</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <h2>Extension system</h2>
            <div class="grid-2">
                <div class="panel" style="background: #22272e;">
                    Apps
                    <ul class="small">
                        <li>Most stable, isolated</li>
                        <li>API driven with Webhooks and App scripts (Twig), bring your own Backend + Frontend (iFrames) + Twig templates</li>
                        <li>Works on-prem, PaaS and SaaS</li>
                    </ul>
                </div>
                <div class="panel" style="background: #22272e;">
                    Plugins
                    <ul class="small">
                        <li>Most capabilities</li>
                        <li>Access to the code and PHP</li>
                        <li>Works on-prem and PaaS</li>
                        <li>Does not work in Saas due to security reasons</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <h2>Creating a plugin</h2>

            <p>
                For quickly getting started with building a plugin, we have an interactive scaffolding command:
            </p>
            <pre><code data-trim class="language_bash">
                bin/console plugin:create
            </code></pre>
        </section>

        <section>
            <h2>Adding entities</h2>
            <h3>Entities via PHP attributes</h3>

            <pre><code data-trim class="language_php" data-line-numbers="0|6|9-11|13-15">
                namespace SwagExamplePlugin\Core\Content\Example;

                use Shopware\Core\Framework\DataAbstractionLayer\Entity;
                use Shopware\Core\Framework\DataAbstractionLayer\Attribute\Entity as EntityAttribute;

                #[EntityAttribute('example_entity')]
                class ExampleEntity extends Entity
                {
                    #[PrimaryKey]
                    #[Field(type: FieldType::UUID)]
                    public string $id;

                    #[Required]
                    #[Field(type: FieldType::STRING, api: true)]
                    public string $name;
                }
            </code></pre>

            <a href="https://developer.shopware.com/docs/guides/plugins/plugins/framework/data-handling/entities-via-attributes.html">Documentation</a>
        </section>

        <section>
            <h2>Adding entities</h2>
            <h3>Registering the entity</h3>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/Resources/config/services.xml -->

                <service id="SwagExamplePlugin\Core\Content\Example\ExampleEntity">
                    <tag name="shopware.entity"/>
                </service>
            </script></code></pre>
        </section>

        <section>
            <h2>Database Migrations</h2>

            <p>creating new migration files</p>
            <pre><code data-trim class="language_bash">
                bin/console database:create-migration
            </code></pre>

            <p>creating database schema based on entity classes</p>
            <pre><code data-trim class="language_bash">
                bin/console dal:create:schema
            </code></pre>

            <p>executing migrations</p>
            <pre><code data-trim class="language_bash">
                bin/console database:migrate SwagExamplePlugin --all
            </code></pre>

            <small>* migrations inside your plugin will be automatically migrated on plugin install</small>
        </section>

        <section>
            <h2>Extending existing entities</h2>

            <pre><code data-trim class="language_php" data-line-numbers="0|3|11-14|16-21">
                // SwagExamplePlugin/src/Extension/Content/Product/CustomExtension.php

                namespace SwagExamplePlugin\Extension\Content\Product;

                use Shopware\Core\Content\Product\ProductDefinition;
                use Shopware\Core\Framework\DataAbstractionLayer\EntityExtension;
                use Shopware\Core\Framework\DataAbstractionLayer\FieldCollection;

                class CustomExtension extends EntityExtension
                {
                    public function getDefinitionClass(): string
                    {
                        return ProductDefinition::class;
                    }

                    public function extendFields(FieldCollection $collection): void
                    {
                        $collection->add(
                            new StringField('custom_string', 'customString')
                        );
                    }
                }
            </code></pre>

            <a href="https://developer.shopware.com/docs/guides/plugins/plugins/framework/data-handling/add-complex-data-to-existing-entities.html">Documentation</a>
        </section>

        <section>
            <h2>Extending existing entities</h2>
            <h3>Registering the extension</h3>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/Resources/config/services.xml -->

                <service id="SwagExamplePlugin\Extension\Content\Product\CustomExtension">
                    <tag name="shopware.entity.extension"/>
                </service>
            </script></code></pre>
        </section>

        <section>
            <h2>Validating existing entities</h2>

            <p>
                The command checks the database schema against the entity definitions.
                It will show you if there are any inconsistencies.
            </p>

            <pre><code data-trim class="language_bash">
                bin/console dal:validate
            </code></pre>
        </section>

        <section>
            <h2>Reading/writing data</h2>
            <h3>Using the repository</h3>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/Resources/config/services.xml -->

                <service id="SwagExamplePlugin\Service\ReadingData">
                    <argument type="service" id="product.repository"/>
                </service>
            </script></code></pre>
        </section>

        <section>
            <h2>Reading data</h2>

            <pre><code data-trim class="language_php" data-line-numbers="0|10-15|17-22|24-31|33-39"><script type="text/template">
                // SwagExamplePlugin/src/Service/ReadingData.php

                namespace SwagExamplePlugin\Service;

                use Shopware\Core\Content\Product\ProductCollection;
                use Shopware\Core\Framework\DataAbstractionLayer\EntityRepository;

                class ReadingData
                {
                    /**
                     * @var EntityRepository<ProductCollection>
                     */
                    public function __construct(
                        private readonly EntityRepository $productRepository
                    ) {}

                    public function readDataById(string $id, Context $context): ProductEntity
                    {
                        $product = $this->productRepository->search(
                            new Criteria([$id]), $context
                        )->first();
                    }

                    public function readData(Context $context): void
                    {
                        $criteria = new Criteria();
                        $criteria->addFilter(new EqualsFilter('name', 'Example name'));
                        $criteria->addAssociation('productReviews');

                        $products = $this->productRepository->search($criteria, $context);
                    }

                    public function readIds(Context $context): void
                    {
                        $criteria = new Criteria();
                        $criteria->addFilter(new EqualsFilter('name', 'Example name'));

                        $products = $this->productRepository->searchIds($criteria, $context);
                    }
                }
            </script></code></pre>

            <a href="https://developer.shopware.com/docs/guides/plugins/plugins/framework/data-handling/reading-data.html">Documentation</a>
        </section>

        <section>
            <h2>Writing data</h2>

            <pre><code data-trim class="language_php" data-line-numbers="0|18-27|29-37|39-47|49-56"><script type="text/template">
                // SwagExamplePlugin/src/Service/WritingData.php

                namespace SwagExamplePlugin\Service;

                use Shopware\Core\Content\Product\ProductCollection;
                use Shopware\Core\Framework\DataAbstractionLayer\EntityRepository;

                class WritingData
                {
                    /**
                     * @var EntityRepository<ProductCollection>
                     */
                    public function __construct(
                        private readonly EntityRepository $productRepository
                    ) {
                    }

                    public function writeData(Context $context): void
                    {
                        $this->productRepository->create([
                            [
                                'name' => 'Example product',
                                'productNumber' => 'SW123',
                                'stock' => 10,
                            ]
                        ], $context);
                    }

                    public function updateData(string $id, Context $context): void
                    {
                        $this->productRepository->update([
                            [
                                'id' => $id,
                                'name' => 'Updated product',
                            ]
                        ], $context);
                    }

                    public function createOrUpdateData(string $id, Context $context): void
                    {
                        $this->productRepository->upsert([
                            [
                                'id' => $id,
                                'name' => 'Updated product',
                            ]
                        ], $context);
                    }

                    public function deleteData(string $id, Context $context): void
                    {
                        $this->productRepository->delete([
                            [
                                'id' => $id,
                            ]
                        ], $context);
                    }
                }
            </script></code></pre>

            <a href="https://developer.shopware.com/docs/guides/plugins/plugins/framework/data-handling/writing-data.html">Documentation</a>
        </section>

        <section>
            <h2>Add CLI Commands</h2>

            <pre><code data-trim class="language_bash" data-line-numbers="0|10-13|14-22">
                // SwagExamplePlugin/src/Command/ExampleCommand.php

                namespace SwagExamplePlugin\Command;

                use Symfony\Component\Console\Command\Command;
                use Symfony\Component\Console\Input\InputInterface;
                use Symfony\Component\Console\Output\OutputInterface;
                use Symfony\Component\Console\Attribute\AsCommand;

                #[AsCommand(
                    name: 'swag-commands:example',
                    description: 'Does something very special',
                )]
                class ExampleCommand extends Command
                {
                    protected function execute(InputInterface $input, OutputInterface $output): int
                    {
                        $output->writeln('It works!');

                        return Command::SUCCESS;
                    }
                }
            </code></pre>
        </section>

        <section>
            <h2>Add CLI Commands</h2>
            <h3>Registering the command</h3>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/Resources/config/services.xml -->

                <service id="SwagExamplePlugin\Command\ExampleCommand">
                    <tag name="console.command"/>
                </service>
            </script></code></pre>
        </section>

        <section>
            <h2>Short break</h2>

            <p>See you in 10 minutes</p>
        </section>

        <section>
            <h2>Your first task</h2>
            <h3>Create a demo data command</h3>

            <ul>
                <li>
                    create 100 demo products:
                    <pre><code data-trim class="language_bash">bin/console framework:demodata --products=100</code></pre>
                </li>
                <li>fetch all product IDs via the product repository</li>
                <li>for each product ID create an FAQ entry</li>
                <li>
                    you can use Faker for questions/answers
                    <pre><code data-trim class="language_php">
                        use Faker\Factory;

                        $faker = Factory::create();

                        $faker->sentence(rand(3, 5)),
                    </code></pre>
                </li>

            </ul>
        </section>

        <section>
            <h2>Setup</h2>

            <pre><code data-trim class="language_bash">
                # Clone repository from github
                git clone git@github.com:shopwareLabs/us-dev-training.git -b task-command

                # Create a symlink to your shopware plugins directory
                ln -s /absolute/path/to/us-dev-training/SwagFaq/
                      shopware/custom/plugins/

                # Refresh installed plugins
                bin/console plugin:refresh

                # Install and activate plugin
                bin/console plugin:install SwagFaq --activate

                # Verify plugin installed and active
                bin/console plugin:list
            </code></pre>
        </section>

        <section>
            <h2>Task 1 results</h2>

            <p>Let's see what we built</p>
        </section>

        <section>
            <h1>Administration</h1>
            <img src="img/AdministrationDashboard.png" height="500px" alt="">
        </section>

        <section>
            <h2>Administration tech stack üë®‚Äçüíª</h2>
            <ul>
                <li>Vue.js 3
                    <ul>
                        <li>still options API</li>
                        <li>no single file components yet</li>
                    </ul>
                </li>
                <li>Twig.js for template inheritance</li>
                <li>TypeScript</li>
                <li>SCSS</li>
                <li>VueX (Pinia in 6.7)</li>
                <li>Vue I18n</li>
            </ul>
        </section>

        <section>
            <h2>Admin Plugin Extensions</h2>
            <div class="panel" style="background: #285d7e;">
                Admin browser window

                <div class="panel small">
                    Admin code
                </div>
                <div class="grid-2">
                    <div class="panel small">
                        Plugin A code
                    </div>
                    <div class="panel small">
                        Plugin B code
                    </div>
                </div>
            </div>
            <div style="margin-top: 16px;">
                <ul>
                    <li>Fixed tech stack</li>
                    <li>Most powerful: override / extend any Admin component</li>
                    <li>Major updates can easily break plugins</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>Admin App Extensions</h2>
                <div class="panel" style="background: #285d7e;">
                    Admin browser window
                </div>
                <div class="panel" style="background: #936319;">
                    App / SDK iFrame
                    <div class="panel small">
                        App A: Main hidden
                    </div>
                </div>
                <div class="panel" style="background: #936319;">
                    App / SDK iFrame
                    <div class="panel small">
                        App A: Location X
                    </div>
                </div>
                <div>
                    <ul>
                        <li>Isolated, Apps support SaaS</li>
                        <li>Flexible tech stack</li>
                        <li>Utilises specific extension points and APIs</li>
                        <li>More stable extension system</li>
                        <li>AdminSDK can be used inside plugins</li>
                    </ul>
                </div>
        </section>

        <section>
            <h2>How the AdminSDK works</h2>
            <img src="img/post-message-communication.png" alt="">
            <small>
                <a href="https://developer.shopware.com/resources/admin-extension-sdk/internals/how-it-works.html">Documentation</a>
            </small>
        </section>

        <section>
            <h2>How to use the AdminSDK</h2>
            <ul>
                <li>You bring your own tech stack, which is rendered in iFrames at specific extension points</li>
                <li>The <a href="https://github.com/shopware/meteor/tree/main/packages/admin-sdk">AdminSDK</a> allows interactions with shopware</li>
                <li>To keep the UI/UX consistent, use our <a href="https://github.com/shopware/meteor/tree/main/packages/component-library">Meteor component library</a></li>
            </ul>
        </section>

        <section>
            <h2>iFrame & Location Concept</h2>
            <ul>
                <li>Extensions run in a hidden iFrame first to register extension points</li>
                <li>Each component section (iFrame) gets a unique <code class="inline">locationId</code></li>
                <li>The height of iFrames can be automatically adjusted</li>
            </ul>
        </section>

        <section>
            <h2>Recommended plugin with SDK structure</h2>
            <pre><code data-trim class="language-txt no-line-numbers" data-line-numbers="|7,10|8,11|8,12,13">
                shopware-root/custom/plugins/
                ‚îî‚îÄ‚îÄ üìÅSwagFaq
                    ‚îî‚îÄ‚îÄ üìÅsrc
                        ‚îî‚îÄ‚îÄ üìÅResources
                            ‚îî‚îÄ‚îÄ üìÅapp
                                ‚îî‚îÄ‚îÄ üìÅadministration
                                    ‚îú‚îÄ‚îÄ üìÑpackage.json
                                    ‚îú‚îÄ‚îÄ üìÑindex.html
                                    ‚îî‚îÄ‚îÄ üìÅsrc
                                        ‚îú‚îÄ‚îÄ üìÑmain.ts
                                        ‚îú‚îÄ‚îÄ üìÑinit-sdk.ts
                                        ‚îî‚îÄ‚îÄ üìÅlocations
                                            ‚îî‚îÄ‚îÄ üìÑinit-locations.ts
                </code></pre>
        </section>

        <section>
            <h2>Plugin + SDK entry points</h2>
            <div class="panel" style="background: #285d7e;">
                Admin browser window

                <div class="panel small">
                    Admin code
                </div>
                <div class="panel small">
                    Plugin main.ts
                </div>
            </div>
            <div class="panel" style="background: #936319;">
                SDK iFrame (main hidden)

                <div class="panel small">
                    Plugin main.ts
                </div>
            </div>
            <div class="panel" style="background: #936319;">
                SDK iFrame (for each location X)

                <div class="panel small">
                    Plugin main.ts
                </div>
            </div>
        </section>

        <section>
            <h2>Plugin initialization</h2>
            <pre><code data-trim class="language-typescript" data-line-numbers="1,2|4-8|9-15|16-22|23-27">
// SwagFaq/src/Resources/app/administration/src/main.ts
import { location } from '@shopware-ag/meteor-admin-sdk';

/**
 * Only execute extensionSDK commands when
 * it is inside a iFrame (only needed for plugins)
 */
if (location.isIframe()) {
    if (location.is(location.MAIN_HIDDEN)) {
        /**
         * This gets executed in the administration in a hidden iFrame.
         * So we don't need any visual components here. It just initializes
         * all extension points needed for this component.
         */
        import('./init-sdk');
    } else {
        /**
         * This gets executed when the administration renders
         * a location. We use a general view renderer which renders
         * the correct view based on the given location.
         */
        import('./locations/init-locations');
    }
} else {
    /**
     * plugin only code would go here
     */
}
            </code></pre>
        </section>

        <section>
            <h2>Registering extension points</h2>
            <pre><code data-trim class="language-typescript" data-line-numbers="1,2|8-13|10|15-24|22">
// SwagFaq/src/Resources/app/administration/src/init-sdk.ts
import { ui } from '@shopware-ag/meteor-admin-sdk';

/**
 * Register extension points in the hidden iFrame
 */
(async () => {
    // Add a new tab to the product detail page
    const TAB_PRODUCT = 'swagfaq-product-detail-tab-faq';
    await ui.tabs('sw-product-detail').addTabItem({
        label: 'swagFaq.productTab',
        componentSectionId: TAB_PRODUCT,
    });

    // Add a component section to the tab
    await ui.componentSection.add({
        component: 'card',
        positionId: TAB_PRODUCT,
        props: {
            title: 'swagFaq.form.title',
            subtitle: 'swagFaq.form.subtitle',
            locationId: 'swagfaq-card-list',
        },
    });
})();
            </code></pre>
        </section>

        <section>
            <h2>Rendering components for locations</h2>
            <pre><code data-trim class="language-typescript" data-line-numbers="1-3|5-13|15-20|22-24">
// SwagFaq/src/Resources/app/administration/src/locations/init-locations.ts
import { createApp, h, defineAsyncComponent } from 'vue';
import { location } from '@shopware-ag/meteor-admin-sdk';

// Register components for each location
const locations = {
    // key is the locationId and has to match the one
    // in the init-sdk.ts file.
    // Tip: use constants for locationIds
    'swagfaq-card-list': defineAsyncComponent(
        () => import('./faq-list.vue')
    ),
};

// Create and mount the Vue app
const app = createApp({
    render: () => h(locations[location.get()]),
});

app.mount('#app');

// Start auto-resizing for the iframe
location.startAutoResizer();
            </code></pre>
        </section>

        <section>
            <h2>Vue Component Example</h2>
            <pre><code data-trim class="language-typescript" data-line-numbers="1|2-6|8-13|15-20">
// SwagFaq/src/Resources/app/administration/src/locations/faq-list.vue
&lt;script setup lang="ts"&gt;
    import { ref } from 'vue';

    const message = ref('Hello from the FAQ list component!');
&lt;/script&gt;

&lt;template&gt;
    &lt;div&gt;
        &lt;h1&gt;FAQ List&lt;/h1&gt;
        &lt;p&gt;{{ message }}&lt;/p&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
    h1 {
        /* Use color from meteor design system */
        color: var(--color-brand-500);
    }
&lt;/style&gt;</code></pre>
        </section>

        <section>
            <h1>Live demo</h1>
            <h2>Shopware Vue Devtools</h2>
            <p>
                Exploring extension points
            </p>
            <small>
                <a href="https://developer.shopware.com/resources/admin-extension-sdk/tooling/vue-devtools.html">Documentation</a>
            </small>
        </section>

        <section>
            <h2>Data API: Reading</h2>
            <pre><code data-trim class="language-typescript" data-line-numbers="1|3-8">
import { data } from '@shopware-ag/meteor-admin-sdk';

data.get({
    id: 'sw-product-detail__product',
    selectors: ['name', 'manufacturer.name'],
}).then((product) => {
    console.log(product);
});
            </code></pre>
            <pre><code data-trim class="language-json" data-line-numbers="">
{
  "name": "Ergonomic Copper Mr. Frenzy",
  "manufacturer": {
    "name": "Turcotte, Rempel and Padberg"
  }
}
            </code></pre>
            <small>
                <a href="https://developer.shopware.com/resources/admin-extension-sdk/api-reference/data/get.html">Documentation</a>
            </small>
        </section>

        <section>
            <h2>Data API: Subscribing</h2>
            <pre><code data-trim class="language-typescript" data-line-numbers="3-11">
import { data } from '@shopware-ag/meteor-admin-sdk';

data.subscribe(
    'sw-product-detail__product',
    ({id, data}) => {
        console.log(data);
    },
    {
        selectors: ['name', 'manufacturer.name']
    },
);
            </code></pre>
            <small>
                <a href="https://developer.shopware.com/resources/admin-extension-sdk/api-reference/data/subscribe.html">Documentation</a>
            </small>
        </section>

        <section>
            <h2>Data API: Updating</h2>
            <pre><code data-trim class="language-typescript" data-line-numbers="3-11">
import { data } from '@shopware-ag/meteor-admin-sdk';

data.update({
    id: 'sw-product-detail__product',
    data: {
        name: 'My updated name',
    },
}).then(() => {
    console.log('successfully updated');
});
            </code></pre>
            <small>
                <a href="https://developer.shopware.com/resources/admin-extension-sdk/api-reference/data/update.html">Documentation</a>
            </small>
        </section>

        <section>
            <h2>Data API: Repositories</h2>
            <small>Database interactions</small>

            <pre><code data-trim class="language-typescript" data-line-numbers="1-2|4|6-10|12-13">
import { data } from '@shopware-ag/meteor-admin-sdk';
const { Criteria } = data.Classes;

const productRepository = data.repository('product');

const criteria = new Criteria();
criteria.addFilter(
    Criteria.equals('product.active', true)
);
criteria.setLimit(3);

const products = await productRepository.search(criteria);
console.log(products);
            </code></pre>
            <small>
                <a href="https://developer.shopware.com/resources/admin-extension-sdk/api-reference/data/repository.html">Documentation</a>
            </small>
        </section>

        <section>
            <h2>Development setup</h2>
            <ul>
                <li>Checkout branch <code class="inline">task-admin</code></li>
                <li>Go into <code class="inline">custom/plugins/SwagFaq/src/Resources/app/administration</code></li>
                <li>Run <code class="inline">npm install</code></li>
                <li>Go back into shopware directory</li>
                <li>Start the "watcher" with <code class="inline">composer run watch:admin</code></li>
                <li>Start changing code</li>
            </ul>
        </section>

        <section>
            <h2>Hands on</h2>
            <small>Try it yourself</small>
            <ul>
                <li>Add tab + card to product detail page</li>
                <li>Get the product <code class="inline">id</code> and <code class="inline">versionId</code> of the detail page</li>
                <li>Query the <code class="inline">swag_faq_entry</code> repository</li>
                <li>(Optional) Display the questions and answers in the card</li>
            </ul>
        </section>

        <section>
            <h1>Show and tell</h1>
            <small>
                <a href="https://github.com/shopwareLabs/us-dev-training/tree/main">Our complete admin solution</a>
            </small>
        </section>

        <!-- Todo Admin:
        - main branch is our finished solution
        - prepare task-admin branch

        - further slides for our (complex) solution?
        -->

        <section>
            <h1>Storefront</h1>
        </section>

        <section>
            <h2>Storefront tech stack üë©‚Äçüíª</h2>
            <ul>
                <li>Server-side rendering</li>
                <li>Symfony Twig</li>
                <li>SCSS</li>
                <li>Bootstrap 5.3</li>
                <li>Vanilla JavaScript</li>
            </ul>
        </section>

        <section>
            <h2>What can be modified</h2>
            <ul>
                <li>üå± Twig templates (HTML)</li>
                <li>üé® (S)CSS</li>
                <li>‚öôÔ∏è JavaScript</li>
            </ul>
        </section>

        <section>
            <h2>Extend templates</h2>
            <ul>
                <li>Twig templates can be overwritten or extended.</li>
                <li>Templates contain Twig <code class="inline">{% block %}</code> placeholders for extensions.</li>
                <li>The template extension is referenced by file name and file path.</li>
            </ul>
            <img width="300" height="300" src="https://uploads.sitepoint.com/wp-content/uploads/2017/06/1498395285Twig.png">
        </section>

        <section>
            <p><strong>Example</strong></p>
            <h2>Extend a template</h2>
        </section>

<!--        <section>-->
            <section>
                <h3>Find the core template</h3>
                <pre><code data-trim class="language-txt no-line-numbers" data-line-numbers="1-9|6">
                shopware-root/src/Storefront/Resources/
                ‚îî‚îÄ‚îÄ üìÅviews/
                    ‚îî‚îÄ‚îÄ üìÅstorefront/
                        ‚îî‚îÄ‚îÄ üìÅelement/
                            ‚îú‚îÄ‚îÄ ...
                            ‚îú‚îÄ‚îÄ üå±cms-element-product-description-reviews.html.twig <--
                            ‚îú‚îÄ‚îÄ üå±cms-element-product-listing.html.twig
                            ‚îú‚îÄ‚îÄ üå±cms-element-product-name.html.twig
                            ‚îî‚îÄ‚îÄ ...
                </code></pre>
            </section>

            <section>
                <h3>Add your template</h3>
                <pre><code data-trim class="language-txt">
                shopware-root/custom/plugins/SwagFaq/src/Resources/
                ‚îî‚îÄ‚îÄ üìÅviews
                    ‚îî‚îÄ‚îÄ üìÅstorefront
                        ‚îî‚îÄ‚îÄ üìÅelement
                            ‚îî‚îÄ‚îÄ üå±cms-element-product-description-reviews.html.twig <--

                </code></pre>
                <ul>
                    <li>Structure from <code class="inline">/Resources/</code> needs to be the same.</li>
                    <li>Creating the same file results in an override.</li>
                </ul>
            </section>
<!--        </section>-->

<!--        <section>-->
            <section>
                <h3>Find block in core template</h3>
                <pre><code data-trim class="language-twig" data-line-numbers="0|15"><script type="text/template">
{# src/Storefront/Resources/views/storefront/element/cms-element-product-description-reviews.html.twig #}
{% if element.data.product %}
    <div class="product-detail-tabs cms-element-{{ element.type }}{% if config.alignment.value %} has-vertical-alignment{% endif %}">
        <div class="card card-tabs">
            {% block element_product_description_reviews_tabs_navigation %}
                <div class="cms-card-header card-header product-detail-tab-navigation product-description-reviews-tab-navigation">
                    {% block element_product_description_reviews_tabs_navigation_container %}
                        <ul class="nav nav-tabs product-detail-tab-navigation-list"
                            id="product-detail-tabs"
                            role="tablist">
                            {% block element_product_description_reviews_tabs_navigation_description %}
                                {# ... #}
                            {% endblock %}

                            {% block element_product_description_reviews_tabs_navigation_review %}
                                {% if config('core.listing.showReview') %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if (ratingSuccess == 1) or (ratingSuccess == -1) %}active{% endif %} product-detail-tab-navigation-link review-tab"
                                           id="{{ reviewTabId }}"
                                           data-bs-toggle="tab"
                                           data-off-canvas-tabs="true"
                                           href="{{ reviewTabHref }}"
                                           role="tab"
                                           aria-controls="{{ reviewTabContent }}"
                                           aria-selected="true">
                                            {{ "detail.tabsReview"|trans|sw_sanitize }}
                                            <span class="product-detail-tab-navigation-icon">
                                                {% sw_icon 'arrow-medium-right' style {'pack':'solid'} %}
                                            </span>
                                        </a>
                                    </li>
                                {% endif %}
                            {% endblock %}
                        </ul>
                    {% endblock %}
                </div>
            {% endblock %}

            {% block element_product_description_reviews_tabs_content %}
                <div class="product-detail-tabs-content card-body">
                    {% block element_product_description_reviews_tabs_content_container %}
                        <div class="tab-content">
                            {% block element_product_description_reviews_tabs_content_description %}
                                {# ... #}
                            {% endblock %}

                            {% block element_product_description_reviews_tabs_content_review %}
                                {# ... #}
                            {% endblock %}
                        </div>
                    {% endblock %}
                </div>
            {% endblock %}
        </div>
    </div>
{% endif %}


                </script></code></pre>
            </section>

            <section>
                <h3>Extend block in your template</h3>
                <pre><code data-trim class="language-twig" data-line-numbers="2|4-13"><script type="text/template">
                {# SwagFaq/src/Resources/views/storefront/element/cms-element-product-description-reviews.html.twig #}
                {% sw_extends '@Storefront/storefront/element/cms-element-product-description-reviews.html.twig' %}

                {% block element_product_description_reviews_tabs_navigation_review %}
                    <li class="nav-item">
                        <a class="nav-link product-detail-tab-navigation-link swag-faq-tab"
                           data-bs-toggle="tab"
                           href="#"
                           role="tab">
                            My own tab
                        </a>
                    </li>
                {% endblock %}
                </script></code></pre>

                <ul>
                    <li><code class="inline">sw_extends</code> makes all blocks of the extended template available.</li>
                    <li><code class="inline">sw_extends</code> enables multi-inheritance.</li>
                </ul>
            </section>

            <section>
                <img src="img/block-override.png">
            </section>

            <section>
                <h3>Parent call</h3>
                <pre><code data-trim class="language-twig" data-line-numbers="5"><script type="text/template">
                {# SwagFaq/src/Resources/views/storefront/element/cms-element-product-description-reviews.html.twig #}
                {% sw_extends '@Storefront/storefront/element/cms-element-product-description-reviews.html.twig' %}

                {% block element_product_description_reviews_tabs_navigation_review %}
                    {{ parent() }}
                    <li class="nav-item">
                        <a class="nav-link product-detail-tab-navigation-link swag-faq-tab"
                           data-bs-toggle="tab"
                           href="#"
                           role="tab">
                            My own tab
                        </a>
                    </li>
                {% endblock %}
                </script></code></pre>

                <p>The <code class="inline">parent()</code> call returns the HTML content of the core block.</p>
            </section>

            <section>
                <img src="img/parent-call.png">
            </section>
<!--        </section>-->

        <section>
            <h2>Add data to the Storefront</h2>
        </section>

        <section>
            <h2>Add a subscriber</h2>
            <pre><code data-trim class="language-txt"><script type="text/template">
SwagFaq/src/Storefront
    ‚îî‚îÄ‚îÄ üìÅPage
        ‚îî‚îÄ‚îÄ üìÅProduct
            ‚îî‚îÄ‚îÄ üìÅSubscriber
                ‚îî‚îÄ‚îÄ üìÑProductPageCriteriaSubscriber.php
            </script></code></pre>

            <pre><code data-trim class="language-xml"><script type="text/template">
            <!-- SwagFaq/Resources/config/services.xml -->
            <service id="SwagFaq\Storefront\Page\Product\Subscriber\ProductPageCriteriaSubscriber">
                <tag name="kernel.event_subscriber"/>
            </service>
            </script></code></pre>
        </section>

        <section>
            <h2>Extend the criteria</h2>
            <pre><code data-line-numbers="0|3|7|12-17|19-22" data-trim class="language-php"><script type="text/template">
<?php declare(strict_types=1);

namespace SwagFaq\Storefront\Page\Product\Subscriber;

use Shopware\Commercial\Licensing\License;
use Shopware\Core\Framework\Log\Package;
use Shopware\Storefront\Page\Product\ProductPageCriteriaEvent;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class ProductPageCriteriaSubscriber implements EventSubscriberInterface
{
    public static function getSubscribedEvents(): array
    {
        return [
            ProductPageCriteriaEvent::class => ['enrichCriteria', 100],
        ];
    }

    public function enrichCriteria(ProductPageCriteriaEvent $event): void
    {
        $event->getCriteria()->addAssociation('swagFaqEntries');
    }
}
            </script></code></pre>
        </section>

        <section>
            <h2>Access the data</h2>

            <pre><code data-trim data-line-numbers="7-8" class="language-twig"><script type="text/template">
{# SwagFaq/src/Resources/views/storefront/element/cms-element-product-description-reviews.html.twig #}
{% sw_extends '@Storefront/storefront/element/cms-element-product-description-reviews.html.twig' %}

{% block element_product_description_reviews_tabs_content_review %}
    {{ parent() }}
    <div class="tab-pane" id="#" role="tabpanel">
        {{ dump() }}
        {{ dump(page.product.extensions.swagFaqEntries) }}
    </div>
{% endblock %}
            </script></code></pre>
        </section>

        <section>
            <h2>Access the data</h2>
            <img src="img/dump-data.png">
        </section>

        <section>
            <h2>Hands on</h2>
            <p>Try it yourself</p>

            <ul>
                <li><strong>Task:</strong> Add an extra Tab to the product detail page next to "Descriptions" and "Reviews".</li>
                <li>Use template extensions to add the Tab.</li>
                <li>Make the Tab and Tab content work with the existing Bootstrap tab structure.</li>
                <li>Bonus: Add the criteria subscriber and display the actual FAQ data.</li>
            </ul>
        </section>

        <section>
            <h2>Add a CMS element</h2>
            <ul>
                <li>CMS elements can be added by the user in the admin interface.</li>
                <li>Can be used in a shopping experiences layout.</li>
                <li>Additional configuration options can be added.</li>
                <li>Flexible and re-usable.</li>
                <li>More decoupled than a specific template override.</li>
            </ul>
        </section>

        <section>
            <h2>CMS element structure</h2>
            <div class="grid-2">
                <div class="panel">
                    Admin
                    <ul class="small">
                        <li>Registration with admin SDK</li>
                        <li>Vue components for preview in the CMS</li>
                        <li>Vue components for the configuration in the CMS</li>
                    </ul>
                </div>
                <div class="panel">
                    Storefront
                    <ul class="small">
                        <li>Twig template that renders the element</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <h2>Register a CMS element</h2>
            <p>CMS elements can be registered via admin SDK</p>
            <pre><code data-trim class="language-javascript">
            // const LOCATION_CMS_ELEMENT = 'swagfaq'
            await cms.registerCmsElement({
                name: LOCATION_CMS_ELEMENT,
                label: 'swagFaq.cms.elementLabel',
                defaultConfig: {
                    exampleConfig: {
                        source: 'static',
                        value: '',
                    },
                },
            });
            </code></pre>
        </section>

        <section>
            <h2>Register a CMS block</h2>
            <p>A block can contain multiple CMS elements</p>
            <pre><code data-trim class="language-javascript">
            // const LOCATION_CMS_ELEMENT = 'swagfaq'
            await cms.registerCmsBlock({
                name: 'swag-faq-block',
                label: 'swagFaq.cms.blockLabel',
                slots: [{ element: LOCATION_CMS_ELEMENT }], // <-- CMS element(s)
                category: 'commerce',
                slotLayout: {
                    grid: 'auto',
                },
            });
            </code></pre>
        </section>

        <section>
            <h2>CMS admin components</h2>
            <pre><code data-trim class="language-txt">
            SwagFaq/src/Resources/app
            ‚îî‚îÄ‚îÄ üìÅadministration
                ‚îî‚îÄ‚îÄ üìÅsrc
                    ‚îî‚îÄ‚îÄ üìÅlocations
                        ‚îú‚îÄ‚îÄ üìÑfaq-cms-config.vue  <-- Configuration modal
                        ‚îú‚îÄ‚îÄ üìÑfaq-cms-element.vue <-- Element in CMS canvas
                        ‚îî‚îÄ‚îÄ üìÑfaq-cms-preview.vue <-- Small preview
            </code></pre>

            <pre><code data-trim class="language-javascript">
            const locations = {
                // ...
                [`${LOCATION_CMS_ELEMENT}-element`]: defineAsyncComponent(
                    () => import('./faq-cms-element.vue')
                ),
                [`${LOCATION_CMS_ELEMENT}-config`]: defineAsyncComponent(
                    () => import('./faq-cms-config.vue')
                ),
                [`${LOCATION_CMS_ELEMENT}-preview`]: defineAsyncComponent(
                    () => import('./faq-cms-preview.vue')
                ),
            };
            </code></pre>
        </section>

        <section>
            <h2>Storefront template</h2>

            <pre><code data-trim  class="language-txt">
            SwagFaq/src/Resources/
            ‚îî‚îÄ‚îÄ üìÅviews
                ‚îî‚îÄ‚îÄ üìÅstorefront
                    ‚îî‚îÄ‚îÄ üìÅelement
                        ‚îî‚îÄ‚îÄ üìÑcms-element-swagfaq.html.twig <--
            </code></pre>

            <p>The file name maps the CMS elements name</p>
            <p><code class="inline">cms-element-{$el-name}.html.twig</code></p>
        </section>

        <section>
            <p><strong>Example</strong></p>
            <h2>Add custom CSS</h2>
        </section>

        <section>
            <h3>Add SCSS entry file</h3>
            <pre><code data-trim data-line-numbers="5-9" class="language-txt">
            shopware-root/custom/plugins/
            ‚îî‚îÄ‚îÄ üìÅSwagFaq
                ‚îî‚îÄ‚îÄ üìÅsrc
                    ‚îî‚îÄ‚îÄ üìÅResources
                        ‚îú‚îÄ‚îÄ üìÅapp
                        ‚îÇ   ‚îî‚îÄ‚îÄ üìÅstorefront
                        ‚îÇ       ‚îî‚îÄ‚îÄ üìÅsrc
                        ‚îÇ           ‚îî‚îÄ‚îÄ üìÅscss
                        ‚îÇ               ‚îî‚îÄ‚îÄ üìÑbase.scss
                        ‚îî‚îÄ‚îÄ üìÅviews
            </code></pre>
            <ul>
                <li>CSS is written in SCSS.</li>
                <li>The <code class="inline">base.scss</code> of the plugin is automatically picked up by shopware.</li>
            </ul>
        </section>

        <section>
            <h3>Add CSS</h3>

            <pre><code data-trim class="language-scss">
            // SwagFaq/src/Resources/app/storefront/src/scss/base.scss
            .footer-main {
                background: $primary-bg-subtle;
            }
            </code></pre>
            <ul>
                <li>In the <code class="inline">base.scss</code> you can write any CSS.</li>
                <li>You can structure your SCSS with <code class="inline">@import</code> files.</li>
                <li>You can use Bootstrap SCSS variables and mixins.</li>
            </ul>
        </section>

        <section>
            <h3>Add JS entry file</h3>

            <pre><code data-trim data-line-numbers="5-8" class="language-txt">
            shopware-root/custom/plugins/
            ‚îî‚îÄ‚îÄ üìÅSwagFaq
                ‚îî‚îÄ‚îÄ üìÅsrc
                    ‚îî‚îÄ‚îÄ üìÅResources
                        ‚îú‚îÄ‚îÄ üìÅapp
                        ‚îÇ   ‚îî‚îÄ‚îÄ üìÅstorefront
                        ‚îÇ       ‚îî‚îÄ‚îÄ üìÅsrc
                        ‚îÇ           ‚îî‚îÄ‚îÄ üìÑmain.js
                        ‚îî‚îÄ‚îÄ üìÅviews
            </code></pre>

            <ul>
                <li>The <code class="inline">main.js</code> is automatically picked up by shopware and creates a script tag in the template.</li>
                <li>JS will be bundled webpack.</li>
            </ul>
        </section>

        <section>
            <h2>Add storefront JS plugin</h2>

            <pre><code data-trim class="language-javascript" data-line-numbers="0|8-11|13-21|26-34"><script type="text/template">
                // SwagExamplePlugin/src/Resources/app/storefront/src/example-plugin/example-plugin.plugin.js

                import HttpClient from "src/service/http-client.service";

                const { PluginBaseClass } = window;

                export default class ExamplePlugin extends PluginBaseClass {
                    static options = {
                        id: null,
                        name: null
                    };

                    init() {
                        this._client = new HttpClient();

                        this._registerEvents();
                    }

                    _registerEvents() {
                        this.button.onclick = this._submit.bind(this);
                    }

                    async _submit(event) {
                        event.preventDefault();

                        this._client.post(
                            '/store-api/example',
                            JSON.stringify({
                                id: this.id,
                                name: this.name,
                            }),
                            (response) => {
                                console.log(response);
                            }
                        );
                    }
                }
            </script></code></pre>

            <a href="https://developer.shopware.com/docs/guides/plugins/plugins/storefront/add-custom-javascript.html">Documentation</a>
        </section>

        <section>
            <h2>Add storefront JS plugin</h2>
            <h3>Registering your plugin</h3>

            <pre><code data-trim class="language-javascript">
                // SwagExamplePlugin/src/Resources/app/storefront/src/main.js

                window.PluginManager.register(
                    'ExamplePlugin',
                    () => import('./example-plugin/example-plugin.plugin'),
                    '[data-example-plugin]'
                );
            </code></pre>
        </section>

        <section>
            <h2>Add storefront JS plugin</h2>
            <h3>Loading your plugin</h3>

            <pre><code data-trim class="language-twig" data-line-numbers="0|5-8|13"><script type="text/template">
                // SwagExamplePlugin/src/Resources/views/storefront/page/product-detail/index.html.twig

                {% sw_extends '@Storefront/storefront/page/product-detail/index.html.twig' %}

                {% set examplePluginOptions = {
                    id: page.product.id,
                    name: page.product.name,
                } %}

                {% block page_product_detail_content %}
                    {{ parent() }}

                    <template data-example-plugin data-example-plugin-options='{{ examplePluginOptions|json_encode }}'></template>
                {% endblock %}
            </script></code></pre>
        </section>
<!--        </section>-->

        <section>
            <h2>Possible tasks</h2>
            <p>Add the Bootstrap carousel?</p>
            <p>Add the complete CMS element?</p>
            <p>Add custom CSS to </p>
        </section>

        <section>
            <h2>Add custom controller</h2>
            <h3>Add storefront controller</h3>

            <pre><code data-trim class="language-php" data-line-numbers="0|12|15-21|23-29">
                // SwagExamplePlugin/src/Storefront/Controller/ExampleController.php

                namespace SwagExamplePlugin\Storefront\Controller;

                use Shopware\Core\System\SalesChannel\SalesChannelContext;
                use Shopware\Storefront\Controller\StorefrontController;
                use Symfony\Component\HttpFoundation\JsonResponse;
                use Symfony\Component\HttpFoundation\Request;
                use Symfony\Component\HttpFoundation\Response;
                use Symfony\Component\Routing\Attribute\Route;

                #[Route(defaults: ['_routeScope' => ['storefront']])]
                class ExampleController extends StorefrontController
                {
                    #[Route(path: '/example/template', name: 'frontend.example.template', methods: ['GET'])]
                    public function showExample(): Response
                    {
                        return $this->renderStorefront('@SwagExamplePlugin/storefront/page/example.html.twig', [
                            'example' => 'Hello world'
                        ]);
                    }

                    #[Route(path: '/example/json', name: 'frontend.example.ajax', methods: ['GET'], defaults: ['XmlHttpRequest' => 'true'])]
                    public function showExample(): JsonResponse
                    {
                        return new JsonResponse([
                            'success' => true,
                        ]);
                    }
                }
            </code></pre>

            <a href="https://developer.shopware.com/docs/guides/plugins/plugins/storefront/add-custom-controller.html">Documentation</a>
        </section>

        <section>
            <h2>Add custom controller</h2>
            <h3>Registering your controller</h3>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/Resources/config/services.xml -->

                <service id="SwagExamplePlugin\Storefront\Controller\ExampleController" public="true">
                    <call method="setContainer">
                        <argument type="service" id="service_container"/>
                    </call>
                </service>
            </script></code></pre>
        </section>

        <section>
            <h2>Add custom controller</h2>
            <h3>Registering the routes</h3>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/src/Resources/config/routes.xml -->

                <routes xmlns="http://symfony.com/schema/routing"
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:schemaLocation="http://symfony.com/schema/routing
                        https://symfony.com/schema/routing/routing-1.0.xsd">

                        <import resource="../../Storefront/Controller/*Controller.php" type="attribute" />
                </routes>
            </script></code></pre>
        </section>

        <section>
            <h2>Shopware API</h2>
            <ul>
                <li>Storefront controller</li>
                <li>Store API route</li>
            </ul>
            <p>What should you use?</p>
        </section>

        <section>
            <h2>Add store API route</h2>
            <h3>Create abstract route class</h3>

            <pre><code data-trim class="language-php">
                // SwagExamplePlugin/src/Core/Content/Example/SalesChannel/AbstractExampleRoute.php

                namespace SwagExamplePlugin\Core\Content\Example\SalesChannel;

                use Shopware\Core\System\SalesChannel\SalesChannelContext;
                use Shopware\Core\System\SalesChannel\StoreApiResponse;
                use Symfony\Component\HttpFoundation\Request;

                abstract class AbstractExampleRoute
                {
                    abstract public function getDecorated(): AbstractExampleRoute;

                    abstract public function submit(Request $request, SalesChannelContext $context): StoreApiResponse;
                }
            </code></pre>
        </section>

        <section>
            <h2>Add store API route</h2>
            <h3>Create route class</h3>

            <pre><code data-trim class="language-php" data-line-numbers="0|12|22-25|27|28-41"><script type="text/template">
                // SwagExamplePlugin/src/Core/Content/Example/SalesChannel/ExampleRoute.php

                namespace SwagExamplePlugin\Core\Content\Example\SalesChannel;

                use Shopware\Core\Framework\DataAbstractionLayer\EntityRepository;
                use Shopware\Core\Framework\DataAbstractionLayer\Search\Criteria;
                use Shopware\Core\Framework\Plugin\Exception\DecorationPatternException;
                use Shopware\Core\System\SalesChannel\SalesChannelContext;
                use Shopware\Core\System\SalesChannel\SuccessResponse;
                use Symfony\Component\Routing\Attribute\Route;

                #[Route(defaults: ['_routeScope' => ['store-api']])]
                class ExampleRoute extends AbstractExampleRoute
                {
                    /**
                     * @param EntityRepository<ProductCollection> $productRepository
                     */
                    public function __construct(private readonly EntityRepository $productRepository)
                    {
                    }

                    public function getDecorated(): AbstractExampleRoute
                    {
                        throw new DecorationPatternException(self::class);
                    }

                    #[Route(path: '/store-api/example', name: 'store-api.example', methods: ['POST'])]
                    public function submit(Request $request, SalesChannelContext $context): StoreApiResponse
                    {
                        $this->productRepository->update(
                            [
                                [
                                    'id' => $request->get('id'),
                                    'name' => $request->get('name'),
                                ]
                            ],
                            $context->getContext()
                        );

                        return new SuccessResponse();
                    }
                }
            </script></code></pre>

            <a href="https://developer.shopware.com/docs/guides/plugins/plugins/framework/store-api/add-store-api-route.html">Documentation</a>
        </section>

        <section>
            <h2>Add store API route</h2>
            <h3>Registering the route</h3>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/Resources/config/services.xml -->

                <service id="Swag\BasicExample\Core\Content\Example\SalesChannel\ExampleRoute">
                    <argument type="service" id="product.repository"/>
                </service>
            </script></code></pre>

            <pre><code data-trim class="language_xml"><script type="text/template">
                <!-- SwagExamplePlugin/src/Resources/config/routes.xml -->

                <import resource="../../Core/**/*Route.php" type="attribute" />
            </script></code></pre>
        </section>

        <section>
            <h2>Your next task</h2>
            <h3>Users create FAQ entries</h3>

            <ul>
                <li>checkout branch <code class="inline">task-route</code></li>
                <li>create Store API route to create FAQ entry</li>
                <li>create storefront controller to expose the new route</li>
                <li>create a form in the FAQ CMS element to submit new entry</li>
                <li>optional: submit form via AJAX by creating a storefront JS plugin</li>
            </ul>
        </section>

        <section>
            <h1>Some best practices</h1>
            <h3>Core (backend)</h3>

            <ul>
                <li>Do not use internal classes directly</li>
                <li>Use the repositories instead of plain SQL queries</li>
                <li>For new routes consider adding a store API route so headless shops can use it</li>
                <li>Proactively check your extensions with the next major feature flag enabled</li>
                <li>Write unit/integration tests using our base classes</li>
                <li>You can use our core PHPStan rules to check your code</li>
            </ul>

            <a href="https://developer.shopware.com/docs/resources/guidelines/">Guidelines</a>
        </section>

        <section>
            <h2>Some best practices</h2>
            <h3>Administration</h3>

            <ul>
                <li>Prefer AdminSDK over <code class="inline">Component.extend</code> or <code class="inline">Component.override</code></li>
                <li>Prefer Meteor components over others for consistent UI/UX</li>
                <li>Prefer using TypeScript instead of JavaScript</li>
                <li>Write automated tests (recommended Unit: Jest + Acceptance: Playwright)</li>
                <li>Let them run in CI pipelines against multiple Shopware versions</li>
            </ul>
        </section>
    </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/markdown/markdown.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
        hash: true,
        center: false,
        slideNumber: 'c/t',
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
    });
</script>
</body>
</html>
